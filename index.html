<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width">
  <link rel="manifest" href="/manifest.json">
</head>
<body>

<div class="switching">
  <div class="switching__content-box">
    <!-- 確率で切り替え有りのエリア -->
    <div class="switching__content js-randomSwitching">
      <div class="switching__content-inner">
        <!-- 初期表示でhazure.pngを中央揃えで表示 -->
        <img id="result-image" src="hazure.png" alt="ハズレ"/>
      </div>
    </div>
    <div class="switching__content">
      <div class="switching__content-inner">
        <!-- クリックカウンタ用の要素 -->
        <div id="click-counter">
          <p>現在の回転数：<span id="count">0</span>回転</p>
          <!-- 画像ボタンに変更 -->
          <img id="click-button" src="button.png" alt="クリックしてカウント" style="cursor: pointer;"/>
        </div>
      </div><!-- /.switching__contentBox -->
    </div><!-- /.switching -->
  </div><!-- /.switching__content-box -->
</div><!-- /.switching -->

<!-- CSS -->
<style>
/*--------------------
 switching
--------------------*/
html, body {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: sans-serif;
  background-color: #f5f5f5;
}

.switching__content-box {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

.switching__content {
  flex: 1;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 10px;
  box-sizing: border-box;
}

.switching__content:nth-child(odd) {
  background-color: rgba(32, 47, 85, 0.1);
}

.switching__content-inner {
  width: 100%;
  max-width: 500px; /* 最大幅を設定して中央に */
  display: flex;
  flex-direction: column;
  align-items: center;
}

.switching__content-text {
  font-size: 24px;
  text-align: center;
}

/* クリックカウンタ */
#click-counter {
  text-align: center;
  margin-top: 20px;
  font-size: 18px;
}

#click-button {
  width: 60%;
  max-width: 250px;
  height: auto;
  margin-top: 15px;
  cursor: pointer;
}

/* 結果画像調整 */
#result-image {
  width: 100%;
  height: auto;
  max-height: 60vh; /* 最大高さを指定 */
  object-fit: contain; /* 縦横比を保って収める */
}

/* 動画のスタイル調整 */
video {
  width: 100%;
  height: auto;
  max-width: 100%;
  max-height: 60vh; /* 最大高さを指定 */
  object-fit: contain; /* 縦横比を保つ */
}
</style>

<script>
    if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service_worker.js').then(function(registration) {
        console.log('ServiceWorker registration successful with scope: ', registration.scope);
    }).catch(function(err) {
        console.log('ServiceWorker registration failed: ', err);
    });
    }
  
//random switching
(function (){
  let i = 0;
  let el = {};
  document.addEventListener('DOMContentLoaded', function () {
    el.randomSwitching = document.querySelectorAll('.js-randomSwitching');
    el.random = Math.floor(Math.random() * 100);  // 0 ～ 99のランダム値
    const clickButton = document.getElementById('click-button');
    let count = localStorage.getItem('clickCount') ? parseInt(localStorage.getItem('clickCount')) : 0;
    const countDisplay = document.getElementById('count');
    let isWinner = localStorage.getItem('isWinner') === 'true';
    const resultImage = document.getElementById('result-image'); // 画像要素を取得

    // 初期表示
    countDisplay.innerText = count;

    // 当選状態の確認と適用
    if (isWinner || el.random < 6) {  // 1/16 の確率 (0～5 の場合)
      randomSwitchFnc();
    }

    // 画像ボタンにクリックイベントを追加
    clickButton.addEventListener('click', function () { 
      if (!isWinner) {
        count++;
        countDisplay.innerText = count;
        localStorage.setItem('clickCount', count);

        el.random = Math.floor(Math.random() * 16);  // 0 ～ 15のランダム値
        if (el.random === 0) {  // 1/16 の確率 (0の場合)
          isWinner = true;
          localStorage.setItem('isWinner', 'true');
          randomSwitchFnc();
        }
      }
    });

    function randomSwitchFnc() {
      // 結果画像を隠す（アタリの場合）
      resultImage.style.display = 'none';

      // 確率で切り替え有りのエリアに動画を表示
      const videoElement = document.createElement('video');
      videoElement.src = 'atari.mp4';  // アタリの動画
      videoElement.controls = true;    // 動画のコントロールボタンを表示

      // スマホ対応のスタイルを追加
      videoElement.style.width = '100%';
      videoElement.style.height = 'auto'; // 高さは自動で調整
      videoElement.style.maxWidth = '100%';  // 最大幅100%
      videoElement.style.maxHeight = '60vh'; // 最大高さを60%に制限
      videoElement.style.objectFit = 'contain'; // 縦横比を保って表示
      
      el.randomSwitching[0].appendChild(videoElement);  // videoを追加

      // 自動で動画を再生
      videoElement.play();

      clickButton.disabled = true;
      clickButton.style.cursor = 'not-allowed';  // クリックを無効化
      clickButton.style.pointerEvents = 'none';

      clickButton.setAttribute('alt', '当選おめでとう！'); // ボタンのテキスト代わり
    }
  }, false);
})();
</script>

</body>
</html>
